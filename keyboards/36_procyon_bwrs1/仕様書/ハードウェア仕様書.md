# Guitar Procyon 36 ハードウェア仕様書

## 概要
- **キーボード名**: Guitar Procyon 36 (MaxTouch版)
- **マイクロコントローラー**: RP2040
- **キー数**: 36キー（左右各18キー）
- **ポインティングデバイス**: MaxTouchデジタイザー
- **RGBバックライト**: WS2812対応
- **エンコーダー**: 2個搭載

## 基本仕様

### 物理仕様
- **サイズ**: 分割キーボード（左右独立）
- **キースイッチ**: メカニカルスイッチ対応
- **キーキャップ**: Cherry MX互換
- **ケース**: プラスチック/アルミニウム

### 電子仕様
- **マイクロコントローラー**: RP2040
- **動作電圧**: 3.3V
- **通信方式**: USB-C
- **ブートローダー**: RP2040標準

## 電子部品仕様

### マイクロコントローラー
- **型番**: RP2040
- **コア**: デュアルコア ARM Cortex-M0+
- **クロック**: 133MHz
- **メモリ**: 264KB SRAM
- **フラッシュ**: 2MB

### ポインティングデバイス
- **型番**: MaxTouchデジタイザー
- **通信方式**: I2C
- **解像度**: 高解像度対応
- **機能**: タッチ、タップ、ジェスチャー

### RGBバックライト
- **型番**: WS2812
- **LED数**: 36個（キー数分）
- **制御方式**: 1ワイヤー制御
- **色数**: 1677万色

### エンコーダー
- **型番**: ロータリーエンコーダー
- **数**: 2個（左右各1個）
- **解像度**: 24ステップ/回転

## ピン配置

### メインコントローラー（RP2040）
```
GP0  - シリアルTX
GP1  - シリアルRX
GP2  - I2C SDA（MaxTouch）
GP3  - I2C SCL（MaxTouch）
GP5  - マトリックス列
GP6  - マトリックス行
GP7  - マトリックス列
GP8  - マトリックス列
GP9  - マトリックス列
GP10 - マトリックス列
GP11 - デジタイザーモーション
GP12 - マトリックス行
GP13 - マトリックス列
GP14 - エンコーダーA（左）
GP15 - RGB LED制御
GP16 - エンコーダーB（左）
GP17 - マトリックス行
GP18 - マトリックス行
GP20 - エンコーダーA（右）
GP21 - エンコーダーB（右）
GP22 - 未使用
GP23 - 未使用
GP25 - キャップスロックLED
GP29 - 分割判定
```

### 右側（スレーブ）
```
GP0  - シリアルTX
GP1  - シリアルRX
GP2  - I2C SDA（MaxTouch）
GP3  - I2C SCL（MaxTouch）
GP5  - マトリックス列
GP6  - マトリックス列
GP7  - マトリックス列
GP8  - マトリックス列
GP9  - マトリックス列
GP10 - マトリックス列
GP11 - デジタイザーモーション
GP12 - マトリックス行
GP13 - マトリックス行
GP17 - マトリックス行
GP18 - マトリックス行
GP25 - キャップスロックLED
GP29 - 分割判定
```

## 接続仕様

### USB接続
- **コネクタ**: USB-C
- **規格**: USB 2.0
- **電力**: 5V/500mA

### 分割接続
- **方式**: シリアル通信
- **ピン**: GP0/GP1
- **速度**: 115200bps

### I2C接続（MaxTouch）
- **SDA**: GP2
- **SCL**: GP3
- **速度**: 100kHz（安定性向上のため）
- **電圧**: 3.3V

## 電源仕様

### メイン電源
- **入力電圧**: 5V（USB）
- **内部電圧**: 3.3V
- **消費電流**: 最大500mA

### RGBバックライト電源
- **電圧**: 5V
- **電流**: LED数 × 60mA
- **制御**: PWM制御

### センサー電源
- **MaxTouch**: 3.3V
- **エンコーダー**: 3.3V
- **マトリックス**: 3.3V

## 機能仕様

### キーマトリックス
- **方式**: 4行 × 6列
- **スキャン方式**: 行スキャン
- **デバウンス**: ソフトウェアデバウンス

### ポインティングデバイス
- **MaxTouchデジタイザー**
  - **通信**: I2C（100kHz）
  - **デバウンス**: 5ms
  - **フィルタリング**: 有効（閾値2）
  - **機能**: タッチ、タップ、ジェスチャー

### RGBバックライト
- **制御**: WS2812
- **色数**: 1677万色
- **アニメーション**: 複数パターン対応
- **レイヤー連動**: レイヤー別色変更

### エンコーダー
- **数**: 2個
- **解像度**: 24ステップ/回転
- **機能**: レイヤー別動作変更

## タッチパッド安定性向上設定

### 問題の背景
- **1本指タッチ**: 不安定な動作
- **2本指タッチ**: 安定した動作
- **原因**: I2C通信速度が高すぎる（1MHz）

### 適用された修正
```c
// I2C通信速度を100kHzに調整
#define I2C1_CLOCK_SPEED 100000

// デバウンス時間を設定
#define POINTING_DEVICE_DEBOUNCE_TIME 5

// フィルタリングを有効化
#define POINTING_DEVICE_FILTER_ENABLE
#define POINTING_DEVICE_FILTER_THRESHOLD 2

// デバッグを有効化
#define MAXTOUCH_DEBUG = yes
```

### 期待される効果
- **1本指タッチの安定化**: 通信速度調整により安定
- **ノイズ除去**: デバウンスとフィルタリングで改善
- **精度向上**: 全体的な動作精度の向上

## トラブルシューティング

### よくある問題
1. **タッチパッドが不安定**: I2C通信速度の確認
2. **RGBが動作しない**: 電源供給の確認
3. **エンコーダーが動作しない**: 配線の確認
4. **分割通信エラー**: ケーブルの確認

### デバッグ方法
1. **シリアルモニター**: デバッグ情報の確認
2. **電圧測定**: 各電源ラインの確認
3. **信号測定**: I2C信号の確認

## 右側キーボード接続時の設定

### 🔌 接続設定
- **マスター設定**: `#define MASTER_RIGHT`
- **ハンドネス検出**: `#define SPLIT_HAND_PIN GP29`
- **右側判定**: `#define SPLIT_HAND_PIN_LOW_IS_RIGHT`

### 📡 通信設定
- **シリアル通信**: フルデュプレックス
- **TXピン**: GP0
- **RXピン**: GP1
- **通信速度**: 最適化済み（rp2040対応）

### 🖱️ タッチパッド設定（右側）
- **I2C通信**: I2CD1
- **SDAピン**: GP2
- **SCLピン**: GP3
- **通信速度**: 100kHz（安定性重視）
- **モーション検出**: GP11
- **アクティブレベル**: ローアクティブ

### ⚡ パフォーマンス最適化
- **USBポーリング間隔**: 1ms
- **NKRO**: 強制有効
- **スキャン効率**: 4キー/スキャン
- **USB接続タイムアウト**: 2秒

### 🔄 初期化処理
1. **起動待機**: 100ms
2. **RGB初期化**: 自動設定
3. **タッチパッド初期化**: 自動設定
4. **レイヤー状態確認**: 自動設定

---

**作成日**: 2025年8月4日  
**バージョン**: 1.1（タッチパッド安定性向上設定追加）  
**作成者**: QMK Firmware 