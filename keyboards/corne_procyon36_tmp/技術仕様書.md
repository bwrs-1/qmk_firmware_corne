# Corne Procyon 36 TMP 技術仕様書

## 目次
1. [ハードウェア仕様](#ハードウェア仕様)
2. [ソフトウェア仕様](#ソフトウェア仕様)
3. [電気仕様](#電気仕様)
4. [機械仕様](#機械仕様)
5. [インターフェース仕様](#インターフェース仕様)
6. [ファームウェア仕様](#ファームウェア仕様)
7. [開発環境](#開発環境)
8. [テスト仕様](#テスト仕様)

---

## ハードウェア仕様

### マイクロコントローラー
- **型番**: RP2040
- **メーカー**: Raspberry Pi Foundation
- **アーキテクチャ**: ARM Cortex-M0+ (デュアルコア)
- **動作周波数**: 133MHz
- **フラッシュメモリ**: 2MB
- **SRAM**: 264KB
- **GPIO**: 30ピン
- **ADC**: 4チャンネル
- **PWM**: 16チャンネル
- **UART**: 2チャンネル
- **SPI**: 2チャンネル
- **I2C**: 2チャンネル

### キーボード基板
- **基板サイズ**: 左右各 約120mm × 約80mm
- **基板層数**: 4層
- **基板材質**: FR-4
- **銅箔厚**: 1oz
- **表面処理**: ENIG (Electroless Nickel Immersion Gold)
- **マスク色**: 黒
- **シルク色**: 白

### キースイッチ
- **対応規格**: Cherry MX互換
- **スイッチ数**: 36個（左右各18個）
- **スイッチタイプ**: メカニカルスイッチ
- **軸色**: 任意（ユーザー選択）
- **寿命**: 5000万回以上

### キーキャップ
- **対応規格**: Cherry MX互換
- **プロファイル**: DSA、XDA、Cherry等対応
- **材質**: PBT、ABS等対応
- **印刷方式**: レーザー刻印、サブリメーション等

---

## ソフトウェア仕様

### ファームウェア
- **ベース**: QMK Firmware
- **バージョン**: 最新版
- **ライセンス**: GPL v2
- **開発言語**: C言語
- **ビルドシステム**: Make

### 機能仕様
- **レイヤー数**: 4レイヤー
- **マクロ対応**: あり
- **VIA対応**: あり
- **RGBライト**: 27個のWS2812B LED
- **エンコーダー**: 2個
- **ポインティングデバイス**: Procyon内蔵

### キーマップ仕様
- **マトリックス**: 4行 × 12列
- **キー数**: 36キー
- **レイヤー切り替え**: モーメンタリ、トグル、レイヤータップ対応
- **特殊キー**: 修飾キー、レイヤーキー、ファンクションキー対応

---

## 電気仕様

### 電源仕様
- **入力電圧**: 5V ±5%
- **動作電圧**: 3.3V
- **消費電流**: 
  - 通常時: 50-100mA
  - RGB点灯時: 最大500mA
  - ポインティングデバイス使用時: +20mA
- **USB規格**: USB 2.0
- **接続器**: USB Type-C

### 信号仕様
- **ロジックレベル**: 3.3V CMOS
- **入力ハイレベル**: 2.0V以上
- **入力ローレベル**: 0.8V以下
- **出力ハイレベル**: 2.4V以上
- **出力ローレベル**: 0.4V以下

### 通信仕様
- **I2C**: 
  - クロック周波数: 1MHz
  - 電圧レベル: 3.3V
  - プルアップ抵抗: 4.7kΩ
- **UART**: 
  - ボーレート: 115200bps
  - データビット: 8
  - パリティ: なし
  - ストップビット: 1

---

## 機械仕様

### 外形寸法
- **左側キーボード**: 120mm × 80mm × 20mm
- **右側キーボード**: 120mm × 80mm × 20mm
- **重量**: 左右各約200g（キーキャップ含む）

### キー配置
- **キー間隔**: 19.05mm（標準）
- **キーサイズ**: 1U（標準）
- **キー高さ**: 約8mm（キーキャップ含む）

### ケース仕様
- **材質**: アルミニウム、アクリル、3Dプリント等
- **色**: 任意（ユーザー選択）
- **脚**: 調整可能な角度

---

## インターフェース仕様

### USBインターフェース
- **規格**: USB 2.0
- **接続器**: USB Type-C
- **ピン配置**: 標準USB Type-C
- **データ転送速度**: 12Mbps

### I2Cインターフェース
- **SDAピン**: GP2
- **SCLピン**: GP3
- **アドレス**: 0x4B（Procyon）
- **クロック周波数**: 1MHz

### エンコーダーインターフェース
- **左側エンコーダー**: GP20, GP21
- **右側エンコーダー**: GP16, GP17
- **解像度**: 4ステップ/クリック
- **プルアップ抵抗**: 10kΩ

### RGB LEDインターフェース
- **データピン**: GP16
- **LED数**: 27個
- **LEDタイプ**: WS2812B
- **制御方式**: 1-Wire制御
- **色深度**: 24bit（RGB各8bit）

---

## ファームウェア仕様

### ビルド設定
```makefile
# 基本設定
MCU = RP2040
BOOTLOADER = rp2040
BOARD = GENERIC_RP_RP2040

# 機能設定
RGBLIGHT_ENABLE = yes
RGB_MATRIX_ENABLE = yes
POINTING_DEVICE_ENABLE = yes
ENCODER_ENABLE = yes
VIA_ENABLE = yes

# ドライバー設定
POINTING_DEVICE_DRIVER = procyon
I2C_DRIVER = I2CD1
SERIAL_DRIVER = vendor
```

### レイヤー構成
```c
enum layer_names {
    _BASE,      // ベースレイヤー（通常入力）
    _LOWER,     // ロワーレイヤー（機能キー）
    _RAISE,     // レイズレイヤー（数字・記号）
    _ADJUST     // 調整レイヤー（設定）
};
```

### キーマップ構造
```c
const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
    [_BASE] = LAYOUT(
        // 左側キー
        KC_TAB,  KC_Q,    KC_W,    KC_E,    KC_R,    KC_T,
        KC_LCTL, KC_A,    KC_S,    KC_D,    KC_F,    KC_G,
        KC_LSFT, KC_Z,    KC_X,    KC_C,    KC_V,    KC_B,
                        KC_LGUI, KC_LGUI,   MO(1),  KC_SPC,
        
        // 右側キー
                        KC_Y,    KC_U,    KC_I,    KC_O,    KC_P,  KC_BSPC,
        KC_H,    KC_J,    KC_K,    KC_L, KC_SCLN, KC_QUOT,
        KC_N,    KC_M, KC_COMM,  KC_DOT, KC_SLSH, KC_RSFT,
        KC_ENT,   MO(2),  KC_BSPC,  KC_RGUI
    ),
    // 他のレイヤー...
};
```

### エンコーダーマップ
```c
const uint16_t PROGMEM encoder_map[][NUM_ENCODERS][NUM_DIRECTIONS] = {
    [_BASE] = { 
        ENCODER_CCW_CW(KC_MS_WH_DOWN, KC_MS_WH_UP),
        ENCODER_CCW_CW(KC_AUDIO_VOL_UP, KC_AUDIO_VOL_DOWN)
    },
    // 他のレイヤー...
};
```

---

## 開発環境

### 必要なツール
- **コンパイラ**: ARM GCC
- **ビルドツール**: Make
- **エディタ**: VSCode、Vim等
- **バージョン管理**: Git

### 開発手順
1. **環境構築**
   ```bash
   # QMK環境のセットアップ
   qmk setup
   ```

2. **ビルド**
   ```bash
   # ファームウェアのビルド
   make corne_procyon36_tmp:default
   ```

3. **書き込み**
   ```bash
   # ファームウェアの書き込み
   make corne_procyon36_tmp:default:flash
   ```

### デバッグ機能
- **シリアル出力**: UART経由でデバッグ情報出力
- **LED表示**: ステータスLEDで動作状態表示
- **ブートローダー**: ダブルタップリセット機能

---

## テスト仕様

### 機能テスト
1. **キー入力テスト**
   - 全キーの入力確認
   - レイヤー切り替え確認
   - 修飾キー動作確認

2. **RGBライトテスト**
   - 全LED点灯確認
   - アニメーション動作確認
   - 色変更確認

3. **エンコーダーテスト**
   - 回転方向確認
   - 機能割り当て確認
   - レイヤー別動作確認

4. **ポインティングデバイステスト**
   - カーソル移動確認
   - クリック動作確認
   - 感度調整確認

### 性能テスト
1. **応答性テスト**
   - キー入力遅延測定
   - ポインティングデバイス遅延測定
   - RGBライト応答性測定

2. **安定性テスト**
   - 長時間動作テスト
   - 温度変化テスト
   - 電源変動テスト

3. **互換性テスト**
   - OS互換性テスト
   - アプリケーション互換性テスト
   - ハードウェア互換性テスト

### 環境テスト
1. **温度テスト**
   - 動作温度範囲: 0°C ～ 50°C
   - 保存温度範囲: -20°C ～ 70°C

2. **湿度テスト**
   - 動作湿度範囲: 20% ～ 80% RH
   - 保存湿度範囲: 10% ～ 90% RH

3. **振動テスト**
   - 輸送時の振動耐性
   - 使用時の振動耐性

---

## 制限事項

### ハードウェア制限
- **最大電流**: USBポートの制限により500mA以下
- **温度制限**: 50°C以下での使用推奨
- **湿度制限**: 80%RH以下での使用推奨

### ソフトウェア制限
- **レイヤー数**: 最大16レイヤー
- **マクロ長**: 最大256文字
- **RGBアニメーション**: 同時点灯LED数制限

### 互換性制限
- **OS**: Windows 10以降、macOS 10.14以降、Linux
- **USB**: USB 2.0以上
- **キーキャップ**: Cherry MX互換のみ

---

## 更新履歴

### v1.0.0 (2024-01-XX)
- 初回リリース
- 基本機能実装
- VIA対応
- Procyonポインティングデバイス対応

### 今後の予定
- 追加機能の実装
- パフォーマンス最適化
- 新機能の追加

---

**注意**: この技術仕様書は開発者向けの詳細仕様です。一般ユーザーは操作手順書を参照してください。 